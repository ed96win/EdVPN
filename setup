yum install epel-release -y
yum groupinstall "Development Tools" -y
yum install kernel-devel libpcap libpcap-devel iptables-devel git wget nano mlocate htop nload net-tools make gcc perl pcre-devel zlib-devel iptables-services openssl-devel lzo-devel pam-devel systemd-devel perl-libwww-perl.noarch perl-LWP-Protocol-https.noarch perl-GDGraph ipset -y
mkdir /root/temp/
cd /root/temp/
wget https://www.openssl.org/source/openssl-1.1.1l.tar.gz
wget https://swupdate.openvpn.org/community/releases/openvpn-2.5.4.tar.gz
tar -xvf openssl-1.1.1l.tar.gz
tar -xvf openvpn-2.5.4.tar.gz
cd openssl-1.1.1l
./config --prefix=/usr --openssldir=/etc/ssl --libdir=lib no-shared zlib-dynamic
make
make install
export LD_LIBRARY_PATH=/usr/local/lib:/usr/local/lib64
echo "export LD_LIBRARY_PATH=/usr/local/lib:/usr/local/lib64" >> ~/.bashrc
cd openvpn-2.5.4
./configure --enable-systemd
make
make install
mkdir /etc/openvpn/
mkdir /var/log/openvpn/
cd /etc/openvpn
wget https://github.com/ed96win/EdVPN/raw/main/openvpn/openvpn.zip
unzip openvpn.zip
cd ..
wget https://raw.githubusercontent.com/ed96win/EdVPN/main/openvpn%40.service
mv openvpn@.service /usr/lib/systemd/system
systemctl daemon-reload
ip=$(curl -s -X GET https://checkip.amazonaws.com)
wget https://raw.githubusercontent.com/ed96win/EdVPN/main/network/ifcfg-sit1
sed -i 's/$serverip/$ip/g' ifcfg-sit1
mv ifcfg-sit1 /etc/sysconfig/network-scripts/
ifup sit1
cd /usr/src
rm -fv csf.tgz
wget --no-check-certificate https://download.configserver.com/csf.tgz
tar -xzf csf.tgz
cd csf
sh install.sh
cd ..
rm csf.tgz
cd /etc/csf/
csf -x
curl -O https://raw.githubusercontent.com/ed96win/EdVPN/main/csf/csf.conf
curl -O https://raw.githubusercontent.com/ed96win/EdVPN/main/csf/csf.allow
curl -O https://raw.githubusercontent.com/ed96win/EdVPN/main/csf/csfpost.sh
cd /usr/src/kernels/
git clone https://github.com/betolj/ndpi-netfilter.git
cd ndpi-netfilter
tar xzvf nDPI.tar.gz
cd nDPI
./autogen.sh
make
make install
cd ..
NDPI_PATH=/usr/src/kernels/ndpi-netfilter/nDPI make
make modules_install
cp /usr/src/kernels/ndpi-netfilter/ipt/libxt_ndpi.so /usr/lib64/xtables/
iptables -m ndpi --help
modprobe xt_ndpi
